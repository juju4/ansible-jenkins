---
## FIXME! defaults/ does not seem to apply to meta dependencies. vars/ do
##	we set vars here to apply to roles in meta

### geerlingguy.jenkins ###

## gitlab is taking 8080
jenkins_http_port: 8888
jenkins_url_prefix: ''
#jenkins_url_prefix: '/jenkins'
#jenkins_admin_username: admin
#jenkins_admin_password: admin

jenkins_plugins:
#    - Folders Plugin
    - build-timeout 
    - build-monitor-plugin
    - credentials-binding
    - timestamper
    - ws-cleanup
    - ant
    - gradle
    - workflow-aggregator
    - github-organization-folder
    - pipeline-stage-view
    - git
    - subversion
    - ssh-slaves
    - matrix-auth
    - pam-auth
    - ldap
    - email-ext
    - mailer
    - throttle-concurrents
    - global-build-stats
    - audit-trail 
#    - xframe-filter-plugin
## OWASP
    - antisamy-markup-formatter
    - dependency-check-jenkins-plugin 
#    - zaproxy      ## deprecated
    - zap
## Extra
    - conditional-buildstep
    - docker-plugin
## https://issues.jenkins-ci.org/browse/JENKINS-26326
    - vagrant
#    - ec2
#    - digitalocean ## DEPRECATED
    - dashboard-view 
    - embeddable-build-status
    - warnings
    - github
    - github-oauth
## http://jakubstas.com/github-and-jenkins-pull-request-checking/
    - ghprb
    - active-directory
## https://github.com/solita/solita-cd/issues/1
## https://issues.jenkins-ci.org/browse/JENKINS-32705
## FIXME! (item=ansible) => {"changed": true, "cmd": ["java", "-jar", "/opt/jenkins-cli.jar", "-s", "http://localhost:8888/", "install-plugin", "ansible", "--username", "admin", "--password", "admin"], "delta": "0:00:00.661496", "end": "2016-11-27 00:19:39.926434", "failed": true, "item": "ansible", "rc": 1, "start": "2016-11-27 00:19:39.264938", "stderr": "\nERROR: Unexpected exception occurred while performing install-plugin command.\njava.io.IOException: Failed to copy ansible to /var/lib/jenkins/plugins/ansible.jpi\n\tat hudson.FilePath.copyTo(FilePath.java:1984)\n\tat hudson.cli.InstallPluginCommand.run(InstallPluginCommand.java:86)\n\tat hudson.cli.CLICommand.main(CLICommand.java:264)\n\tat hudson.cli.CliManagerImpl.main(CliManagerImpl.java:93)\n\tat sun.reflect.GeneratedMethodAccessor33.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat hudson.remoting.RemoteInvocationHandler$RPCRequest.perform(RemoteInvocationHandler.java:894)\n\tat hudson.remoting.RemoteInvocationHandler$RPCRequest.call(RemoteInvocationHandler.java:869)\n\tat hudson.remoting.RemoteInvocationHandler$RPCRequest.call(RemoteInvocationHandler.java:828)\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:153)\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:50)\n\tat hudson.remoting.Request$2.run(Request.java:336)\n\tat hudson.remoting.InterceptingExecutorService$1.call(InterceptingExecutorService.java:68)\n\tat hudson.cli.CliManagerImpl$1.call(CliManagerImpl.java:64)\n\tat hudson.remoting.CallableDecoratorAdapter.call(CallableDecoratorAdapter.java:18)\n\tat hudson.remoting.CallableDecoratorList$1.call(CallableDecoratorList.java:21)\n\tat jenkins.util.ContextResettingExecutorService$2.call(ContextResettingExecutorService.java:46)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.io.IOException: remote file operation failed: ansible at hudson.remoting.Channel@4dc27e3e:CLI channel from /127.0.0.1: java.io.FileNotFoundException: ansible (Is a directory)\n\tat hudson.FilePath.act(FilePath.java:992)\n\tat hudson.FilePath.act(FilePath.java:974)\n\tat hudson.FilePath.copyTo(FilePath.java:2005)\n\tat hudson.FilePath.copyTo(FilePath.java:1981)\n\t... 21 more\nCaused by: java.io.FileNotFoundException: ansible (Is a directory)\n\tat java.io.FileInputStream.open0(Native Method)\n\tat java.io.FileInputStream.open(FileInputStream.java:195)\n\tat java.io.FileInputStream.<init>(FileInputStream.java:138)\n\tat hudson.FilePath$41.invoke(FilePath.java:2010)\n\tat hudson.FilePath$41.invoke(FilePath.java:2005)\n\tat hudson.FilePath$FileCallableWrapper.call(FilePath.java:2731)\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:153)\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:50)\n\tat hudson.remoting.Request$2.run(Request.java:336)\n\tat hudson.remoting.InterceptingExecutorService$1.call(InterceptingExecutorService.java:68)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n\tat ......remote call to CLI channel from /127.0.0.1(Native Method)\n\tat hudson.remoting.Channel.attachCallSiteStackTrace(Channel.java:1537)\n\tat hudson.remoting.UserResponse.retrieve(UserRequest.java:253)\n\tat hudson.remoting.Channel.call(Channel.java:822)\n\tat hudson.FilePath.act(FilePath.java:985)\n\t... 24 more", "stdout": "Installing a plugin from local file: ansible", "stdout_lines": ["Installing a plugin from local file: ansible"], "warnings": []}
#    - ansible
    - depgraph-view
#    - DiskCheck Plugin
    - packer
    - violations
    - analysis-core
    - checkstyle
#    - pmd
#    - brakeman
## http://jenkins-php.org/
## http://www.phpmetrics.org/documentation/jenkins.html
## https://www.sitepoint.com/series/php-quality-assurance-with-jenkins/
## https://www.future-processing.pl/blog/php-code-analysis-on-jenkins/
## http://erichogue.ca/2011/05/php/continuous-integration-in-php/
    - sidebar-link
    - cloverphp
    - crap4j
    - dry
    - htmlpublisher
    - jdepend
    - plot
    - xunit
    - phing
## http://www.alexconrad.org/2011/10/jenkins-and-python.html
## http://bhfsteve.blogspot.ca/2012/04/automated-python-unit-testing-code_27.html
    - cobertura
#    - maven-plugin
## ticketing
#    - jira
#    - periodicbackup
    - ansicolor
    - text-finder
    - powershell
    - thinBackup
## https://jenkins.io/projects/blueocean/   new UX, alpha, sep 2016
    - blueocean
    - job-dsl


## If using PHPMetrics, need less strict Content Security Policy. see https://github.com/phpmetrics/website/pull/2
## java.lang.OutOfMemoryError: Heap space   = -Xmx1048m
## session timeout (default 30min)
jenkins_java_options: "-Djenkins.install.runSetupWizard=false -Dmail.smtp.starttls.enable=true -Dhudson.DNSMultiCast.disabled=true -Dhudson.udp=-1 -Dhudson.model.DirectoryBrowserSupport.CSP=\\\"sandbox; default-src 'self'; img-src 'self'; style-src 'self' nvd3.org cdn.rawgit.com; script-src 'self' d3js.org nvd3.org cdn.rawgit.com\\\" -Xmx1048m"
jenkins_init_changes:
  - {option: "JENKINS_ARGS", value: "--prefix={{ jenkins_url_prefix }} --httpListenAddress=127.0.0.1 --ajp13Port=-1 --httpsPort=-1 --sessionTimeout=60"}
  - {option: "JENKINS_JAVA_OPTIONS", value: "{{ jenkins_java_options }}"}

### geerlingguy.gitlab ###

## Note: GitlabCE has its own nginx and need extra customization to behave as subdir... keeping separate
#gitlab_external_url: "http://x.y.z.2:9090/"
## FIXME! this settings make gitlab-ctl reconfigure failing
#gitlab_redirect_http_to_https: false
gitlab_create_self_signed_cert: false
gitlab_nginx_listen_port: 9090
## gitlab: cant set initial password?
## http://docs.gitlab.com/ce/security/reset_root_password.html
## set project limit? cli?
## Admin Area: Settings
## https://github.com/gitlabhq/gitlabhq/issues/10151
## Disable external signup? cli?
## Admin Area: Settings
## set users? cli?
## Enable InfluxDB Metrics ? cli?

